/**
 * jQuery.moveScreen - Move screen using jQuery
 * Copyright @ 2005-2012 Mohsen Samiee - mohsen@bihamtaa.com - http://www.mohsensamiee.ir
 * Dual licensed under MIT and GPL.
 * Date: 04/09/2012
 * @author Mohsen Samiee
 * @version 1.0
 *
 * http://www.bihamtaa.com
 */
 
(function($,undefined){

  $.fn.moveScreen = function(options){

    var defaults = {
		speed: 1000,
		ratio: 2,
		easing: 'easeOutQuad'
    };

	this.each(function(){

		var $selector = $(this);

		options = $.extend(defaults, options);

		var x1, y1, x2, y2, px, py, spx, spy = 0;
		var isMouseDown = false;
		var timeoutMouseScroller = false, isMouseScroller = false;

		$(this).mousedown(function(e){
			$selector.queue([]).stop();
			x1 = parseInt(e.pageX);
			y1 = parseInt(e.pageY);
			isMouseDown = true;
		});

		$selector.mousemove(function(e){
			x2 = parseInt(e.pageX, 10);
			y2 = parseInt(e.pageY, 10);
			if (isMouseDown){ 
				if (!$selector.hasClass("moveScreen-disabled")){
					window.scrollBy(x1 - x2, y1 - y2);
				}
			}else if (isMouseScroller && !timeoutMouseScroller){
				/*
				timeoutMouseScroller = setTimeout(function(){
					isMouseScroller = false;
					if (x2 < x1 && y2 == y1){
						px = x1 - x2;
						py = $(document).scrollTop();
						spx = '+=' + px * options.ratio + 'px';
						spy = py + 'px';
						return scr(spy, spx);
					}else if (x2 < x1 && y2 > y1){
						px = x1 - x2;
						py = y2 - y1;
						spx = '+=' + px * options.ratio + 'px';
						spy = '-=' + py * options.ratio + 'px';
						return scr(spy, spx);
					}else if (x2 == x1 && y2 > y1){
						px = $(document).scrollLeft();
						py = y2 - y1;
						spx = px + 'px';
						spy = '-=' + py * options.ratio + 'px';
						return scr(spy, spx);
					}else if (x2 > x1 && y2 > y1){
						px = x2 - x1;
						py = y2 - y1;
						spx = '-=' + px * options.ratio + 'px';
						spy = '-=' + py * options.ratio + 'px';
						return scr(spy, spx);
					}else if (x2 > x1 && y2 == y1){
						px = x2 - x1;
						py = $(document).scrollTop();
						spx = '-=' + px * options.ratio + 'px';
						spy = py + 'px';
						return scr(spy, spx);
					}else if (x2 > x1 && y2 < y1){
						px = x2 - x1;
						py = y1 - y2;
						spx = '-=' + px * options.ratio + 'px';
						spy = '+=' + py * options.ratio + 'px';
						return scr(spy, spx);
					}else if (x2 == x1 && y2 < y1){
						px = $(document).scrollLeft();
						py = y1 - y2;
						spx = px + 'px';
						spy = '+=' + py * options.ratio + 'px';
						return scr(spy, spx);
					}else if (x2 < x1 && y2 < y1){
						px = x1 - x2;
						py = y1 - y2;
						spx = '+=' + px * options.ratio + 'px';
						spy = '+=' + py * options.ratio + 'px';
						return scr(spy, spx);
					}
				}, 50);
				 */
			}
		});

		$selector.mouseup(function(e){
			isMouseDown = false;
			isMouseScroller = true;
			timeoutMouseScroller = false;
			x1 = parseInt(e.pageX, 10);
			y1 = parseInt(e.pageY, 10);
		});

		$selector.mousestop(function(){
			isMouseScroller = false;
			timeoutMouseScroller = false;
		}, {
			onStopMove: function(e){
				isMouseScroller = false;
				timeoutMouseScroller = false;
			}
		});

		function scr(spy, spx){
			if (!$selector.hasClass("moveScreen-disabled")){
				timeoutMouseScroller = false;
				$selector.queue([]).stop();
				$selector.scrollTo({top: spy,left: spx}, options.speed, {easing: options.easing, onAfter: function(){
					
				}});
			}
		}

    });

  };

})(jQuery);